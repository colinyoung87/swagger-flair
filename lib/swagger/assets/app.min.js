$(function(){window.Flair={config:window.config,sections:[],scrollTimeout:null,initialize:_.bind(function(){$.ajax({method:"GET",url:config.docs_url}).done(Flair.boot).fail(function(){console.error("Could not fetch docs from:",config.docs_url)})},this),boot:function(a){window.addEventListener("popstate",Flair.toHashSection),console.log("Flair boot",a),Flair.buildSections(a),Flair.setTitle(a.info.title),Flair.renderNav(),Flair.renderContent(),Flair.ready()},ready:function(){Flair.delegateEvents(),PR.prettyPrint(),$(".app-loading").fadeOut(300,function(){$(this).remove(),Flair.toHashSection(),setTimeout(function(){$("body").removeClass("loading")},300)})},buildSections:function(a){var b,c,d,e=a.paths;Flair.sections=[{slug:"home",title:"Home",paths:[{title:a.info.title,description:a.info.description,slug:"top"}]}],_.each(e,function(a,e){_.each(a,function(a,f){c=String(a.tags[0]).toLowerCase().replace(/[^a-z0-9 -_]/g,"").replace(/ /,"-"),b=_.find(Flair.sections,function(a){return a.slug===c}),d=!b,d&&(b={slug:c,title:a.tags[0],paths:[]}),b.paths.push({method:f,url:e,slug:String(a.title).toLowerCase().replace(/[^a-z0-9 -_]/g,"").replace(/ /g,"-"),title:a.title,description:a.description,params:a.parameters,responses:a.responses}),d?Flair.sections.push(b):Flair.sections=_.map(Flair.sections,function(a){return a.slug===c?b:a})})})},setTitle:function(a){$(".js-app-title").html(a),$("title").html(a)},renderNav:function(){var a=$(".nav");a.prepend(ejs.render(a.find("script").html(),{sections:Flair.sections}))},renderContent:function(){var a=$(".content");a.prepend(ejs.render(a.find("script").html(),{sections:Flair.sections,base_url:Flair.config.base_url}))},delegateEvents:function(){Flair.initNavLinks(),Flair.initScrollListeners(),Flair.initForms(),Flair.initMenuBtn(),setTimeout(Flair.onScroll,300)},initNavLinks:function(){$(document).on("click",".nav a, .anchor",function(a){a.preventDefault();var b=$(a.currentTarget),c=$(".right"),d=b.attr("href"),e=$(d).offset().top,f="true"===b.attr("data-main");history.pushState&&a.originalEvent&&history.pushState(null,null,d),f||(e-=69),c.animate({scrollTop:c.scrollTop()+e},300),f&&($(".nav > ul > li.active").removeClass("active"),b.closest("li").addClass("active"))})},initScrollListeners:function(){var a,b=$(".right");$(".section > .title").each(function(b,c){a=$(c),a.attr("data-top",a.offset().top)}),b.on("scroll.content",Flair.onScroll)},onScroll:function(a){var b,c=$(".right"),d=c.scrollTop();$(".section > .title").each(function(a,c){if(b=$(c),parseInt(b.attr("data-top"),10)<=d){if(!b.hasClass("fixed")){var e=b.closest(".section").attr("id");b.addClass("fixed"),clearTimeout(Flair.scrollTimeout),Flair.scrollTimeout=setTimeout(function(){$(".nav li").removeClass("active"),$(".nav a[href='#"+e+"']").closest("li").addClass("active")},300)}}else if(b.hasClass("fixed")){var e=b.closest(".section").attr("id"),f=$(".nav a[href='#"+e+"']").closest("li");b.removeClass("fixed"),clearTimeout(Flair.scrollTimeout),Flair.scrollTimeout=setTimeout(function(){$(".nav li").removeClass("active"),f.prev().addClass("active")},300)}})},toHashSection:function(){if(!window.location.hash)return void $(".right").animate({scrollTop:0},300);var a=$(".nav a[href='"+window.location.hash+"']");a&&a.trigger("click")},initForms:function(){$(document).on("submit","form",function(a){a.preventDefault();var b=$(a.currentTarget),c=b.find(".form-actions button");c.hasClass("processing")||(c.addClass("processing"),$.ajax({method:b.attr("method"),url:b.attr("action"),data:b.serialize()}).done(function(a,d,e){Flair.formResponse(b,c,e.status,e.responseJSON)}).fail(function(a){Flair.formResponse(b,c,a.status,a.responseJSON)}))}),$(document).on("click",".form-response a.close",function(a){a.preventDefault(),$(a.currentTarget).closest(".form-response").slideUp()})},formResponse:function(a,b,c,d){b.removeClass("processing");var e=a.closest(".endpoint").find(".form-response");e.find(".status span").html(c),e.find("code").removeClass("prettyprinted").html(JSON.stringify(d,null,4)),PR.prettyPrint(),e.slideDown()},initMenuBtn:function(){$(document).on("click",".menu-btn",function(a){a.preventDefault(),$("body").toggleClass("menu-open")})}},Flair.initialize()});